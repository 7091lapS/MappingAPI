/* PublicaMundi Mapping API version 0.1.0 2015-11-12 */

var xmlToJSON=function(){this.version="1.3";var a={mergeCDATA:!0,grokAttr:!0,grokText:!0,normalize:!0,xmlns:!0,namespaceKey:"_ns",textKey:"_text",valueKey:"_value",attrKey:"_attr",cdataKey:"_cdata",attrsAsObject:!0,stripAttrPrefix:!0,stripElemPrefix:!0,childrenAsArray:!0},b=new RegExp(/(?!xmlns)^.*:/),c=new RegExp(/^\s+|\s+$/g);return this.grokType=function(a){return/^\s*$/.test(a)?null:/^(?:true|false)$/i.test(a)?"true"===a.toLowerCase():isFinite(a)?parseFloat(a):a},this.parseString=function(a,b){return this.parseXML(this.stringToXML(a),b)},this.parseXML=function(d,e){for(var f in e)a[f]=e[f];var g={},h=0,i="";if(a.xmlns&&d.namespaceURI&&(g[a.namespaceKey]=d.namespaceURI),d.attributes&&d.attributes.length>0){var j={};for(h;h<d.attributes.length;h++){var k=d.attributes.item(h);o={};var l="";l=a.stripAttrPrefix?k.name.replace(b,""):k.name,a.grokAttr?o[a.valueKey]=this.grokType(k.value.replace(c,"")):o[a.valueKey]=k.value.replace(c,""),a.xmlns&&k.namespaceURI&&(o[a.namespaceKey]=k.namespaceURI),a.attrsAsObject?j[l]=o:g[a.attrKey+l]=o}a.attrsAsObject&&(g[a.attrKey]=j)}if(d.hasChildNodes())for(var m,n,o,p=0;p<d.childNodes.length;p++)m=d.childNodes.item(p),4===m.nodeType?a.mergeCDATA?i+=m.nodeValue:g.hasOwnProperty(a.cdataKey)?(g[a.cdataKey].constructor!==Array&&(g[a.cdataKey]=[g[a.cdataKey]]),g[a.cdataKey].push(m.nodeValue)):a.childrenAsArray?(g[a.cdataKey]=[],g[a.cdataKey].push(m.nodeValue)):g[a.cdataKey]=m.nodeValue:3===m.nodeType?i+=m.nodeValue:1===m.nodeType&&(0===h&&(g={}),n=a.stripElemPrefix?m.nodeName.replace(b,""):m.nodeName,o=xmlToJSON.parseXML(m),g.hasOwnProperty(n)?(g[n].constructor!==Array&&(g[n]=[g[n]]),g[n].push(o)):(a.childrenAsArray?(g[n]=[],g[n].push(o)):g[n]=o,h++));else i||(a.childrenAsArray?(g[a.textKey]=[],g[a.textKey].push(null)):g[a.textKey]=null);if(i)if(a.grokText){var q=this.grokType(i.replace(c,""));null!==q&&void 0!==q&&(g[a.textKey]=q)}else a.normalize?g[a.textKey]=i.replace(c,"").replace(/\s+/g," "):g[a.textKey]=i.replace(c,"");return g},this.xmlToString=function(a){try{var b=a.xml?a.xml:(new XMLSerializer).serializeToString(a);return b}catch(c){return null}},this.stringToXML=function(a){try{var b=null;if(window.DOMParser){var c=new DOMParser;return b=c.parseFromString(a,"text/xml")}return b=new ActiveXObject("Microsoft.XMLDOM"),b.async=!1,b.loadXML(a),b}catch(d){return null}},this}();"undefined"!=typeof module&&null!==module&&module.exports?module.exports=xmlToJSON:"function"==typeof define&&define.amd&&define(function(){return xmlToJSON}),function(a,b){"use strict";var c={__namespace:"PublicaMundi"},d=null,e=null,f=[],g=null;c.LayerType={WMS:"WMS",WFS:"WFS",TILE:"Tile",GeoJSON:"GeoJSON",KML:"KML",GML:"GML",GPX:"GPX",CSV:"CSV",WCS:"WCS",WCPS:"WCPS"},c.version="0.0.1",c.define=function(b){if(b)for(var c=b.split("."),d=a,e=0;e<c.length;e++)c[e]&&("undefined"==typeof d[c[e]]&&(d[c[e]]={__namespace:c.slice(0,e+1).join(".")}),d=d[c[e]])};var h=function(a,b){if(b)for(var c in b)b.hasOwnProperty(c)&&void 0!==b[c]&&(a[c]=b[c]);return a};c.Class=function(){for(var a,b,c=(arguments,function(){"function"==typeof this.initialize&&this.initialize.apply(this,arguments)}),d={},e=function(){},f=0,g=arguments.length;g>f;++f)"function"==typeof arguments[f]?(0===f&&g>1&&(b=arguments[f].prototype.initialize,arguments[f].prototype.initialize=e(),d=new arguments[f],d.constructor=c,void 0===b?delete arguments[f].prototype.initialize:arguments[f].prototype.initialize=b),a=arguments[f].prototype):a=arguments[f],h(d,a);return c.prototype=d,c.prototype.constructor=c,c};var i={};c.registerFrameworkResolver=function(a,b){return i.hasOwnProperty(a)?(console.log("Resolver for framework "+a+" already registered."),!1):(i[a]=b,!0)},c.resolveFramework=function(){for(var a in i)if(i[a]())return a;return null},c.isDefined=function(a){return"undefined"!=typeof a},c.isFunction=function(a){return"function"==typeof a},c.isObject=function(a){return"object"==typeof a},c.isEmpty=function(a){if(null===a)return!0;if(a.length>0)return!1;if(0===a.length)return!0;for(var b in a)if(hasOwnProperty.call(a,b))return!1;return!0},c.isClass=function(b){for(var c=b.split("."),d=a,e=0;e<c.length;e++){if(!c[e]||"undefined"==typeof d[c[e]])return!1;if(e===c.length-1&&"function"!=typeof d[c[e]])return!1;d=d[c[e]]}return!0},c.isArray=function(a){return Array.isArray?Array.isArray(a):"[object Array]"===Object.prototype.toString.call(a)},c.getQueryStringParameters=function(a){var b={};return a.replace(new RegExp("([^?=&]+)(=([^&#]*))?","g"),function(a,c,d,e){b[c]=e}),b},c.locator={_dependencies:[],_factories:[],register:function(a,b){var c=this._dependencies.indexOf(a);return 0>c?(this._dependencies.push(a),this._factories.push(b)):this._factories[c]=b,b},unregister:function(a){var b=this._dependencies.indexOf(a);b>=0&&(this._dependencies.splice(b,1),this._factories.splice(b,1))},resolve:function(a){var b=this._dependencies.indexOf(a);return 0>b?null:this._factories[b]},create:function(a,b){var c=this.resolve(a);return c?new c(b):null}},c.registry={_LayerTypeRegistry:[],registerLayerType:function(a){for(var b=null,d=0;d<this._LayerTypeRegistry.length;d++)if(this._LayerTypeRegistry[d].layer===a.layer&&this._LayerTypeRegistry[d].framework===a.framework){b=this._LayerTypeRegistry[d];break}b?b.type=a.type:(b={layer:a.layer,framework:a.framework,type:a.type},this._LayerTypeRegistry.push(b)),c.locator.register(a.type,a.factory)},resolveLayerType:function(a){for(var b=null,d=c.resolveFramework(),e=0;e<this._LayerTypeRegistry.length;e++)if(this._LayerTypeRegistry[e].layer===a&&this._LayerTypeRegistry[e].framework===d){b=this._LayerTypeRegistry[e];break}return b?b.type:null},createLayer:function(a){var b=this.resolveLayerType(a.type);return b?c.locator.create(b,a):null},getFactories:function(){return this._LayerTypeRegistry.map(function(a){return c.locator.resolve(a.type)})}},c._PM=a.PM,c.noConflict=function(){return a.PM===c&&("undefined"!=typeof this._PM?a.PM=this._PM:delete a.PM),this},d=jQuery("script").last().attr("src"),d=d.substring(0,d.lastIndexOf("/")+1),e=jQuery("script").last().data("library"),e||(e="ol"),c.ready=function(a){if(!c.isFunction(a))return void console.log("Argument for ready() is not a function.");if(c.resolveFramework()||(console.log("Loading scripts..."),b("<link/>",{rel:"stylesheet",type:"text/css",href:d+"lib/"+e+"/"+e+".css"}).appendTo("head"),f.push(d+"lib/"+e+"/"+e+".js"),f.push(d+"publicamundi."+e+".js")),0===f.length)a();else{var h=function(){g&&(console.log("["+g+"] has been loaded."),g=null),f.length>0?(g=f[0],f.shift(),b.ajax({url:g,dataType:"script",success:h,cache:!0})):a()};h()}},a.PublicaMundi=a.PM=c}(window,jQuery),function(a,b){"use strict";"undefined"!=typeof b&&(b.Map=b.Class({initialize:function(a){this._map=null,this._layers=[],this._control=null,this._viewbox="0,0,0,0",this._popup=null,this._highlight=null,this._featureOverlay=null,this._layerHighlight=null,this._featureHighlight=null,a=a||{},a.target=b.isDefined(a.target)?a.target:null,a.projection=b.isDefined(a.projection)?a.projection:"EPSG:3857",a.center=b.isDefined(a.center)?a.center:[0,0],a.zoom=b.isDefined(a.zoom)?a.zoom:2},setExtent:function(a){return this},_setViewBox:function(){return this},_getViewBox:function(){return this._viewbox},setLayerControl:function(a){return this},getLayerControl:function(){return this._control},getMap:function(){return this._map},getOverlay:function(){return this._popup},getFeatureOverlay:function(){return this._featureOverlay},setCenter:function(a,b){return this},getCenter:function(){return null},setZoom:function(a){return this},getZoom:function(){return null},getProjection:function(){return null},getTarget:function(){return null},getLayers:function(){return this._layers},_listen:function(){return null},createLayer:function(a){var c=null;switch(typeof a){case"string":var d=[".gson",".geojson"];d.some(function(b){return a.indexOf(b,a.length-b.length)})&&this.createLayer({type:b.LayerType.GeoJSON,url:a,projection:this.getProjection()});break;case"object":for(var e=b.registry.getFactories(),f=0;f<e.length;f++)if(a instanceof e[f]){c=a;break}c||(b.isDefined(a.projection)||(a.projection=this.getProjection()),c=b.registry.createLayer(a),c.setMap(this)),c?this.addLayer(c):console.log("Layer of type "+a.type+" is not supported.")}return c&&this._layers.push(c),c},addLayer:function(a){}}),b.locator.register("PublicaMundi.Map",b.Map),b.map=function(a){return b.locator.create("PublicaMundi.Map",a)},b.configure=function(a,c,d){var e="string"==typeof a?b.map({target:a}):b.map(a);return jQuery.getJSON(c,function(a){if(a.center&&e.setCenter(a.center),a.zoom&&e.setZoom(a.zoom),b.isArray(a.layers))for(var c=0;c<a.layers.length;c++)e.addLayer(a.layers[c]);b.isFunction(d)&&d.call(this,a)}),e})}(window,window.PublicaMundi),function(a,b){"undefined"!=typeof b&&(b.define("PublicaMundi"),b.Helpers=b.Class({initialize:function(a){}}),b.locator.register("PublicaMundi.Helpers",b.Helpers))}(window,PublicaMundi),function(a,b){"undefined"!=typeof b&&(b.define("PublicaMundi"),b.Parser=b.Class({initialize:function(a){},parseWMS:function(a){var b,c={};try{b=xmlToJSON.parseXML(a,{childrenAsArray:!1})}catch(d){return console.log(d),c.success=!1,c.error_msg="Server response is not a valid XML document. Cannot display",c}if(b.ServiceExceptionReport)return c.success=!1,c.error_msg="Service Exception Report. Please try again.",c;var e=null;if(b.WMS_Capabilities)e=b.WMS_Capabilities;else if(b.WMT_MS_Capabilities&&(e=b.WMT_MS_Capabilities,e instanceof Array))for(var f in e){var g=e[f];g.Capability&&(e=g)}if(!e._attr)return c.success=!1,c.error_msg="WMS Capabilities Load Exception. Please try again.",c;c.version=e._attr.version._value;var h=[];if(!e.Capability.Layer)return c.success=!1,c.error_msg="No WMS Layers found in provided endpoint.",c;e.Capability.Layer.Layer?h=e.Capability.Layer.Layer:e.Capability.Layer&&(h=e.Capability.Layer),h instanceof Array||(h=[h]);for(var f in h){var i=h[f];i.Name=i.Name._text,i.Title=i.Title?i.Title._text:i.Name._text,i.Abstract=i.Abstract?i.Abstract._text:"",i.CRS=i.CRS?i.CRS._text:"";var j=null,k=null;if(i.EX_GeographicBoundingBox){j=i.EX_GeographicBoundingBox;var l=j.eastBoundLongitude._text,m=j.westBoundLongitude._text,n=j.northBoundLatitude._text,o=j.southBoundLatitude._text;k=[m,o,l,n],i.EX_GeographicBoundingBox=k}else if(i.LatLonBoundingBox){j=i.LatLonBoundingBox._attr;var l=j.minx._value,m=j.maxx._value,n=j.maxy._value,o=j.miny._value;k=[m,o,l,n],i.EX_GeographicBoundingBox=k}}return c.Layer=h,c.success=!0,c},parseWFS:function(a){var b,c={};try{b=xmlToJSON.parseXML(a,{childrenAsArray:!1})}catch(d){return console.log(d),c.success=!1,c.error_msg="Server response is not a valid XML document. Cannot display",c}var e=null;if(!b.WFS_Capabilities)return console.log("unexpected version"),console.log(f),c.success=!1,c.error_msg="WFS Capabilities error. Could not load layers.",c;e=b.WFS_Capabilities;var f=null;e._attr&&(f=e._attr.version._value),c=e,c.version=f;var g=[];if(e.FeatureTypeList)g=e.FeatureTypeList.FeatureType;else{if(!e["wfs:FeatureTypeList"])return c.success=!1,c.error_msg="No WFS Features provided in selected endpoint.",c;g=e["wfs:FeatureTypeList"]["wfs:FeatureType"]}for(var h in g){var i=g[h];i.Name=i.Name._text,i.Title=i.Title._text,i.Abstract=i.Abstract._text;var j=[];for(var k in i.Keywords.Keyword){var l=i.Keywords.Keyword[k];j.push(l._text)}i.Keywords=j;var m=i.WGS84BoundingBox,n=null;if(m){var o=m.LowerCorner._text.split(" "),p=m.UpperCorner._text.split(" ");n=[parseFloat(o[0]),parseFloat(o[1]),parseFloat(p[0]),parseFloat(p[1])],i.WGS84BoundingBox=n}var q=null;if(i.DefaultCRS){var r=i.DefaultCRS._text,s=r.split(":");q=s[s.length-3]+":"+s[s.length-1],i.DefaultCRS=q}}c.Layer=g;var t=null;return e.OperationsMetadata&&(t=e.OperationsMetadata.Operation),c.Format=t,c.success=!0,c}}),b.locator.register("PublicaMundi.Parser",b.Parser),b.parser=function(a){return b.locator.create("PublicaMundi.Parser",a)})}(window,PublicaMundi),function(a,b){"undefined"!=typeof b&&(b.define("PublicaMundi"),b.Layer=b.Class({initialize:function(a){this._map=null,this._type=null,this._layer=null,this._style={normal:{color:"#3399CC",radius:6,weight:1.25,opacity:1,fillColor:"#FFFFFF",fillOpacity:.4},highlight:{}},this._extent=a.bbox||null,this._options=a||{}},setMap:function(a){this._map=a},getMap:function(){return this._map},getType:function(){return this._type},getLayer:function(){return this._layer},getStyle:function(){return this._style},fitToMap:function(){return this._extent},onLayerLoad:function(){return this._layer},getOptions:function(){return this._options},addToControl:function(){return null},update:function(){return null},_transformStyle:function(){return null}}),b.locator.register("PublicaMundi.Layer",b.Layer))}(window,PublicaMundi);
//# sourceMappingURL=publicamundi.js.map