<!doctype html>
<html lang="en">
<head>
    <link rel="stylesheet" href="lib/OpenLayers/css/ol.css" type="text/css" />
    <style>
        .map {
            height: 400px;
            width: 800px;
            margin-left: auto;
            margin-right: auto;
        }

        .ol-attribution ul, .ol-attribution a, .ol-attribution a:not([ie8andbelow]) {
            color: black !important;
        }
    </style>
    <!--<script src="lib/jQuery/jquery-2.1.0.js"></script>-->
    <script src="lib/OpenLayers/build/ol-whitespace.js"></script>
    <script src="http://cdnjs.cloudflare.com/ajax/libs/proj4js/1.1.0/proj4js-compressed.js" type="text/javascript"></script>
    <script src="http://cdnjs.cloudflare.com/ajax/libs/proj4js/1.1.0/defs/EPSG21781.js" type="text/javascript"></script>
    <title>OpenLayers 3</title>
</head>
<body>
    <div id="map" class="map"></div>
    <script type="text/javascript">
        var map = new ol.Map({
            target: 'map',
            layers: [
                //new ol.layer.Tile({
                //    title: "Global Imagery",
                //    source: new ol.source.TileWMS({
                //        url: 'http://maps.opengeo.org/geowebcache/service/wms',
                //        params: { LAYERS: 'bluemarble', VERSION: '1.1.1' }
                //    })
                //})
                //, new ol.layer.Image({
                //    title: "Global Imagery",
                //    source: new ol.source.ImageWMS({
                //        url: 'http://maps.opengeo.org/geowebcache/service/wms',
                //        params: { LAYERS: 'bluemarble', VERSION: '1.1.1' }
                //    })
                //})
                //, new ol.layer.Tile({
                //    source: new ol.source.MapQuest({ layer: 'sat' })
                //})
                new ol.layer.Tile({
                    source: new ol.source.OSM()
                    //opacity: 0.5,
                })
                //new ol.layer.Tile({
                //    source: new ol.source.BingMaps({
                //        imagerySet: 'Road',
                //        key: 'Ak-dzM4wZjSqTlzveKz5u0d4IQ4bRzVI309GxmkgSVr1ewS6iPSrOvOKhA-CJlm3'
                //    })
                //})
                , new ol.layer.Vector({
                    title: 'Buildings',
                    source: new ol.source.KML({
                        projection: 'EPSG:3857',
                        url: 'data/kml/timezones.kml'
                    }),
                    style: (function () {
                        var textStroke = new ol.style.Stroke({
                            color: '#fff',
                            width: 3
                        });
                        var textFill = new ol.style.Fill({
                            color: '#000'
                        });

                        return function (feature, resolution) {
                            if (feature.get('shape_area') < 3000) {
                                return [new ol.style.Style({
                                    fill: new ol.style.Fill({ color: 'olive' }),
                                    stroke: new ol.style.Stroke({ color: 'black', width: 1 }),
                                    text: new ol.style.Text({
                                        font: '12px Calibri,sans-serif',
                                        text: feature.get('key'),
                                        fill: textFill,
                                        stroke: textStroke
                                    })
                                })];
                            } else {
                                return [new ol.style.Style({
                                    fill: new ol.style.Fill({ color: 'navy' }),
                                    stroke: ol.style.Stroke({ color: 'black', width: 1 }),
                                    text: new ol.style.Text({
                                        font: '12px Calibri,sans-serif',
                                        text: feature.get('key'),
                                        fill: textFill,
                                        stroke: textStroke
                                    })
                                })];
                            }
                        };
                    })()
                })
                //, new ol.layer.Vector({
                //    title: 'Earthquakes',
                //    source: new ol.source.GeoJSON({
                //        url: 'data/geojson/earthquakes.json'
                //    }),
                //    style: function (feature, resolution) {
                //        console.log(feature);
                //        if (feature.get('georss_elev') > -10000) {
                //            return [new ol.style.Style({
                //                image: new ol.style.Circle({
                //                    radius: 5,
                //                    fill: new ol.style.Fill({ color: '#565656' }),
                //                    stroke: new ol.style.Stroke({
                //                        color: '#FFFFFF'
                //                    })
                //                })
                //            })];
                //        }
                //        return [new ol.style.Style({
                //            image: new ol.style.Circle({
                //                radius: 5,
                //                fill: new ol.style.Fill({ color: '#FFFFFF' }),
                //                stroke: new ol.style.Stroke({
                //                    color: '#FF0000'
                //                })
                //            })
                //        })];
                //    }
                //    //style: new ol.style.Style({
                //    //    image: new ol.style.Circle({
                //    //        radius: 5,
                //    //        fill: new ol.style.Fill({ color: '#565656' }),
                //    //        stroke: new ol.style.Stroke({
                //    //            color: '#FFFFFF'
                //    //        })
                //    //    })
                //    //})
                //})
                //, new ol.layer.Image({
                //    title: 'Earthquakes',
                //    source: new ol.source.ImageVector({
                //        source: new ol.source.GeoJSON({
                //            url: 'data/geojson/earthquakes.json'
                //        }),
                //        style: new ol.style.Style({
                //            image: new ol.style.Circle({
                //                radius: 3,
                //                fill: new ol.style.Fill({ color: 'white' })
                //            })
                //        })
                //    })
                //})
            ],
            view: new ol.View2D({
                //projection: 'EPSG:4326',
                projection: 'EPSG:3857',
                //center: ol.proj.transform([23.51, 38.82], 'EPSG:4326', 'EPSG:3857'),
                //center: [-40, 0],
                //zoom: 4
                center: ol.proj.transform([-122.791859392, 42.3099154789], 'EPSG:4326', 'EPSG:3857'),
                //center: [-122.791859392, 42.3099154789],
                zoom: 3
            }),
            controls: ol.control.defaults().extend([
                new ol.control.ScaleLine()
            ]),

            interactions: ol.interaction.defaults().extend([
              new ol.interaction.Select({
                  featureOverlay: new ol.FeatureOverlay({
                      style: new ol.style.Style({
                          image: new ol.style.Circle({
                              radius: 5,
                              fill: new ol.style.Fill({
                                  color: '#FF0000'
                              }),
                              stroke: new ol.style.Stroke({
                                  color: '#000000'
                              })
                          })
                      })
                  })
              })
            ])
        });
        map.on('singleclick', function (e) {
            var pixel = map.getEventPixel(e.originalEvent);

            var FeatureIdList = new Array; // A List of all Id's

            map.forEachFeatureAtPixel(pixel, function (feature, layer) {
                if (layer.get("visible") == true) { // Is the current layer visible ?
                    var Id = feature.get('title');
                    if (FeatureIdList.indexOf(Id) < 0) {
                        FeatureIdList.push(Id);
                    }
                }
            });
            FeatureIdList.sort();
            console.log(FeatureIdList);
        });
    </script>
</body>
</html>
